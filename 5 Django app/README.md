# English Football League Analysis

A Django web application for analyzing English Premier League data with interactive visualizations powered by Bokeh. The system also has an AI-powered club analysis feature.

Note: a large fraction of this project was generated by AI using Cursor.

You can read more about how this app was developed on my blog:
* https://blog.engora.com/2025/11/how-to-rapidly-build-and-deploy-data.html

## Commentary on app

### Response times

The app is a little slow to update some pages, especially when there's a lot of data. I'm running some tests to find out causes.

### AI response

The app includes some AI-generated content (club and season analysis). This can take 30 seconds or more to update. At the time of writing, I'm using the free tier of Gemini and my prompt is quite complex. I tried parallelizing my query, but I ran into free tier limitations. I tried simplifying my query, but that gave worse results. For now, there's not much I can do to speed things up.

**Note**: The AI features require a `GOOGLE_API_KEY` environment variable to be set. Without it, the club analysis pages will still work but won't display AI-generated insights.

## Features

- **Trends Analysis**: Interactive charts showing trends over time
- **Goals Analysis**: Factors that influence goal scoring
- **Club Analysis**: See how clubs have performed over time.
- **User Management**: Admin panel for user management
- **Authentication**: Secure login/logout with role-based access
- **Interactive Visualizations**: Powered by Bokeh for rich data exploration

## Requirements

- Python 3.13.4
- Django 5.2.8
- PostgreSQL database
- Bokeh 3.8.0
- Bootstrap 5
- Google GenAI SDK (for AI-powered club analysis)
- Additional dependencies: pandas, numpy, statsmodels (see requirements.txt)

## Installation

1. **Clone the repository**:
   ```bash
   git clone <repository-url>
   cd "5 Django app"
   ```

2. **Create a virtual environment**:
   ```bash
   python -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```

3. **Install dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

4. **Set up environment variables**:
   ```bash
   cp env.example .env
   # Edit .env with your database credentials
   ```

5. **Set up the database**:
   ```bash
   python manage.py makemigrations
   python manage.py migrate
   ```

6. **Create initial users**:
   ```bash
   python manage.py create_users
   ```

7. **Run the development server**:
   ```bash
   python manage.py runserver
   ```

## Environment Variables

Create a `.env` file with the following variables:

```env
# Required
SECRET_KEY=your-secret-key-here
DATABASE_URL=postgresql://user:password@host:port/database

# Optional (for development)
DEBUG=True

# Required for AI-powered club analysis
GOOGLE_API_KEY=your-google-api-key-here

# For production deployment on Render
RENDER_EXTERNAL_HOSTNAME=your-app-name.onrender.com
```

**Note**: The application uses `DATABASE_URL` for database configuration. If you need to construct it manually, the format is:
```
postgresql://FOOTBALL_USER:FOOTBALL_PASSWORD@FOOTBALL_HOST:FOOTBALL_PORT/Football
```

## Application Structure

### Apps

- **about**: Main landing page and application description
- **trends**: Interactive trend analysis with Bokeh charts
- **goals**: Goal scoring factor analysis
- **club_analysis**: AI-powered club performance analysis with interactive visualizations
- **admin_app**: User management and admin functionality
- **registration**: User authentication and login/logout functionality

### Key Features

- **Custom User Model**: Extended Django user model with admin flag
- **Bokeh Integration**: Interactive charts for data visualization
- **Bootstrap Styling**: Responsive design with green color scheme
- **Crispy Forms**: Enhanced form rendering
- **Role-based Access**: Different permissions for admin and regular users

## Usage

1. **Access the application**: Navigate to `http://localhost:8000`
2. **Login**: Use the provided credentials to access features
3. **Explore Trends**: View interactive charts showing league trends over time
4. **Analyze Goals**: Examine factors influencing goal scoring
5. **Club Analysis**: View detailed club performance analysis with AI-generated insights
   - Select a club to see league performance over time
   - View season-by-season analysis with AI-powered commentary
   - Interactive charts showing club statistics
6. **Manage Users** (Admin only): Add, edit, or delete users through the admin dashboard

## Database Connection

The application connects to an existing PostgreSQL database using the `DATABASE_URL` environment variable. The database should contain tables for:
- Football matches and results
- Club history and season data
- League information
- Attendance and discipline statistics

Make sure your database is accessible and contains the required tables before running the application.

## Development

### Running Tests
```bash
python manage.py test
```

### Creating Migrations
```bash
python manage.py makemigrations
python manage.py migrate
```

### Creating Superuser
```bash
python manage.py createsuperuser
```

### Creating Initial Users
```bash
python manage.py create_users
```

## Deployment

The application is configured for deployment on Render. Key deployment considerations:

- Set `RENDER_EXTERNAL_HOSTNAME` environment variable in your Render service
- Set `DEBUG=False` in production (automatically handled when `RENDER_EXTERNAL_HOSTNAME` is set)
- Static files are served using WhiteNoise middleware
- Database connection uses `DATABASE_URL` environment variable
- Ensure all required environment variables are set in your Render service settings

## Styling

The application uses a green color scheme as specified:
- Primary green: #2E8B57
- Light green: #90EE90
- Very light green: #98FB98
- All text is black and minimum 12pt font size

## License

This project is for educational and analytical purposes.

